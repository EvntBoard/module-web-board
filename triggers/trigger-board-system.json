{
  "name": "/board/system",
  "type": "queue",
  "code": "// i don't use shared script cause this is used in single place\nconst EVNTBOARD_CACHE_FILENAME = \"/board/data.json\"\n\nconst EVNTBOARD_SAMPLE_BOARD = {\n  id: null,\n  name: '',\n  slug: '',\n  description: '',\n  default: false,\n  image: null,\n  color: null,\n  width: 5,\n  height: 5,\n  layout: []\n}\n\nconst EVNTBOARD_SAMPLE_BUTTON = {\n  id: null,\n  slug: null,\n  type: 'text',\n  text: null,\n  image: null,\n  color: null,\n  column_start: null,\n  column_end: null,\n  row_start: null,\n  row_end: null,\n}\n\nconst eventName = event.name\nconst payload = event.payload\nconst emitter = event.emitter\n\nswitch (eventName) {\n    case \"evntboard-start\": {\n      let newData = file.read(EVNTBOARD_CACHE_FILENAME)\n      let tmpData = temp.get(\"evntboard-cache\")\n\n      if (!newData) {\n        newData = []\n        newData.push({\n          ...EVNTBOARD_SAMPLE_BOARD,\n          id: 'first-board',\n          name: 'First Board',\n          default: true,\n          layout: [\n            {\n              ...EVNTBOARD_SAMPLE_BUTTON,\n              id: 'first-btn',\n              slug: \"fart-btn\",\n              type: \"button\",\n              color: \"rgb(114,7,137)\",\n              text: \"Click me\",\n              column_start: 1,\n              column_end: 2,\n              row_start: 1,\n              row_end: 2,\n            }\n          ]\n        })\n        file.write(EVNTBOARD_CACHE_FILENAME, JSON.stringify(newData,  0, 2))\n      } else {\n        newData = JSON.parse(newData)\n      }\n\n      if (!tmpData) {\n        temp.set(\"evntboard-cache\", [])\n        tmpData = temp.get(\"evntboard-cache\")\n      }\n\n      newEvent({\n        idParent: event.id,\n        name: 'evntboard-init',\n        payload: newData,\n        emitter\n      })\n\n      newEvent({\n        idParent: event.id,\n        name: 'evntboard-init-tmp',\n        payload: tmpData,\n        emitter\n      })\n      break;\n    }\n\n      // BOARD\n    case \"evntboard-create\": {\n      let data = JSON.parse(file.read(EVNTBOARD_CACHE_FILENAME))\n\n      const newData = [\n        ...data,\n        {\n          ...SAMPLE_BOARD,\n          ...payload,\n        }\n      ]\n\n      file.write(EVNTBOARD_CACHE_FILENAME, JSON.stringify(newData,  0, 2))\n\n      newEvent({\n        idParent: event.id,\n        name: 'evntboard-patch',\n        payload: newData,\n        emitter\n      })\n      break;\n    }\n    case \"evntboard-update\": {\n      let data = JSON.parse(file.read(EVNTBOARD_CACHE_FILENAME))\n\n      const newData = [\n        ...data.filter((i) => i.id !== payload.id),\n        {\n          ...EVNTBOARD_SAMPLE_BOARD, // au cas ou !\n          ...payload\n        }\n      ]\n\n      file.write(EVNTBOARD_CACHE_FILENAME, JSON.stringify(newData,  0, 2))\n\n      newEvent({\n        idParent: event.id,\n        name: 'evntboard-patch',\n        payload: newData,\n        emitter\n      })\n      break;\n    }\n    case \"evntboard-delete\": {\n      let data = JSON.parse(file.read(EVNTBOARD_CACHE_FILENAME))\n\n      const newData = data.filter((i) => i.id !== payload.id)\n\n      file.write(EVNTBOARD_CACHE_FILENAME, JSON.stringify(newData,  0, 2))\n\n      newEvent({\n        idParent: event.id,\n        name: 'evntboard-patch',\n        payload: newData,\n        emitter\n      })\n      break;\n    }\n    case \"evntboard-tmp\": {\n      let evntboardCache = temp.get(\"evntboard-cache\")\n      if (!evntboardCache) {\n        evntboardCache = []\n        evntboardCache.push(payload)\n      } else {\n        evntboardCache = [\n          ...evntboardCache.filter((i) => i.slug !== payload.slug ),\n          {\n            ...evntboardCache.find((i) => i.slug === payload.slug),\n            ...payload\n          }\n        ]\n      }\n      temp.set(\"evntboard-cache\", evntboardCache)\n      newEvent({\n        idParent: event.id,\n        name: 'evntboard-patch-tmp',\n        payload: evntboardCache,\n        emitter\n      })\n    }\n  }",
  "locker": null,
  "conditions": [
    {
      "event": "evntboard-create",
      "code": "true"
    },
    {
      "event": "evntboard-delete",
      "code": "true"
    },
    {
      "event": "evntboard-start",
      "code": "true"
    },
    {
      "event": "evntboard-tmp",
      "code": "true"
    },
    {
      "event": "evntboard-update",
      "code": "true"
    }
  ]
}